<!DOCTYPE html>
{% extends "global.html" %}
{% load static %}
{% block include %}
	<!-- Include CSS	-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.css" />
	<link rel="stylesheet" type="text/css" href="{% static 'css/search.css'%}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'css/menu.css' %}">
	<!-- Include JS	-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js"></script>
	<script src="https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js"></script>
	<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script>
    <script>
        $(document).ready(function() {
            var calendar = $('#calendar').fullCalendar({
                editable:false,
                header:
                {
                    left:'prev,next',
                    center:'title',
                    right:'month,agendaWeek,agendaDay'
                },
				height: "auto",
                events: "/load_search/",
				displayEventTime: false,
                eventRender:function(event, element)
                {
                    element.find('.fc-title').append("<br/><b>Tuteur: </b><br/><b>Salle: </b>" + event.title,"<br/><b>Description: </b><p>" + event.description +"</p>");
                },
                selectable:true,
                selectHelper:true,
                select: function(start, end, allDay)
                {
                    /*     var title = prompt("Enter Event Title");
                    if(title)
                    {
                    var start = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
                    var end = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");
                    $.ajax({
                    url:"insert.php",
                    type:"POST",
                    data:{title:title, start:start, end:end},
                    success:function()
                    {
                    calendar.fullCalendar('refetchEvents');
                    alert("Added Successfully");
                    }
                    })
                    }*/
                },

                eventResize:function(event)
                {
                    /*     var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
                    var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
                    var title = event.title;
                    var id = event.id;
                    $.ajax({
                    url:"update.php",
                    type:"POST",
                    data:{title:title, start:start, end:end, id:id},
                    success:function(){
                    calendar.fullCalendar('refetchEvents');
                    alert('Event Update');
                    }
                    })*/
                },

                eventDrop:function(event)
                {
                    /*     var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
                    var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
                    var title = event.title;
                    var id = event.id;
                    $.ajax({
                    url:"update.php",
                    type:"POST",
                    data:{title:title, start:start, end:end, id:id},
                    success:function()
                    {
                    calendar.fullCalendar('refetchEvents');
                    alert("Event Updated");
                    }
                    });*/
                },

                eventClick:function(event)
                {
                    if(confirm("Voulez vous vous inscrire ?"))
                    {
                        var id = event.id;
                        $.ajax({
                            url:"/subscribe/"+ event.id,
                            type:"GET",
                            success:function()
                            {
                                calendar.fullCalendar('refetchEvents');
                                alert("Vous etes inscrit");
                            }
                        })
                    }
                },
            });
        });
    </script>
{% endblock %}
{% block menu %}
        <a href="/add">Ajout Cours</a>
        <a href="/search" id="active">Recherche</a>
		<a href="/profil" class="profil">Profil</a>
{% endblock %}
{% block content %}
    <div class="jumbotron text-center">
        <h2 class="display-4">Prochaines s√©ances</h2>
        <hr class="my-4">
        <br />
        <div class="container text-left">
            <div id="calendar"></div>
        </div>
		<!-- The Modal -->
		<div id="myModal" class="modal">

		  <!-- Modal content -->
		  <div class="modal-content">
			<span class="close">&times;</span>
			<p>Some text in the Modal..</p>
		  </div>
		</div>
    </div>
<script>
// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>
{% endblock %}